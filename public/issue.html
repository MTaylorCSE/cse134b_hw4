<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title id="issueName_title">Loading...</title>
        <link href="site.css" type="text/css" rel="stylesheet" media="screen">
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js"></script>
        <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDMcldNQv43OCqtkWK1ruYgvrPWWhd0ASM",
            authDomain: "cse134b-hw4-41ab1.firebaseapp.com",
            databaseURL: "https://cse134b-hw4-41ab1.firebaseio.com",
            projectId: "cse134b-hw4-41ab1",
            storageBucket: "cse134b-hw4-41ab1.appspot.com",
            messagingSenderId: "1059552826976"
        };
        firebase.initializeApp(config);
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            var urlParams = new URLSearchParams(window.location.search);
            firebase.database().ref("users/"+user.uid+"/method").once("value").then(function(snapshot){
                console.log(snapshot.val());
                placeDeliveryButton(snapshot.val());
                if(snapshot.val() === "rest"){
                    if(document.readyState === "complete"){
                        document.getElementById("saveButton").onclick = function(){saveEditREST(true)};
                        getIssueContentFromLocalDB(urlParams.get("issue"));
                    }else{
                        window.addEventListener("load",function(){
                            document.getElementById("saveButton").onclick = function(){saveEditREST(true)}; 
                            getIssueContentFromLocalDB(urlParams.get("issue"));
                        });
                    }
                    
                }else{
                    if(document.readyState === "complete"){
                        document.getElementById("saveButton").onclick = function(){saveEditREST(false)}; 
                        getIssueContentFromLocalDB(urlParams.get("issue"));
                    }else{
                        window.addEventListener("load",function(){
                            document.getElementById("saveButton").onclick = function(){saveEditREST(false)}; 
                            getIssueContentFromLocalDB(urlParams.get("issue"));
                        });
                    }
                    getIssueContentFromFirebaseDB(urlParams.get("issue"),user.uid);
                }
            });
          } else {
            window.location.replace("index.html");
          }
        });
        </script>
        <script src="scripts/issueContent.js"></script>
    </head>
    <body>
        <button id="signOutButton" onclick="(function() {
            firebase.auth().signOut().then(function() {
                // Sign-out successful.
                }).catch(function(error) {
                console.log(error);
                console.log('Sign out error');
                });
        })()">Sign out</button>

        <h1>Issue Name: <span id="issueName_heading"></span></h1>
        <section>
            <h2>Issue Type: 
                <span class="issueType" id="issueType"></span>
                <select id="selectIssueType" hidden>
                    <option label="Loading..." hidden disabled selected id="defaultOptionIssueType"></option>
                    <option>Visual</option>
                    <option>Functionality</option>
                    <option>Other</option>
                </select>
            </h2>
        </section>
        <section>
            <h2>Issue Description:</h2>
        </section>
        <pre contenteditable="false" id="issueDescription">
</pre>
        <a id="imageLink" href="#"><div><img height="400" src="placeholder_loading.gif" id="issueImage" alt="Oops!"></div></a>
        <!-- Loading image source: https://gfycat.com/gifs/detail/SkinnySeveralAsianlion -->
        <!-- No attachment image source: https://www.freeiconspng.com/img/23483 -->
        <noscript>
            <p>Warning! If you're seeing this, you have JavaScript disabled. Editing issues will not work without JavaScript enabled.</p>
        </noscript>
        <div>
        <button id="editButton" onclick="editMode()">Edit</button>
        <button hidden id="saveButton">Save</button>
        <button hidden id="cancelButton" onclick="cancelEdit()">Cancel</button>
        </div>
        <p>OR</p>
        <form action="issueslist.html" method="GET">
            <button>Return to Issues List</button>
        </form>
    </body>
    
</html>
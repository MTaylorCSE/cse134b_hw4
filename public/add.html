<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Add an Issue</title>
        <link href="site.css" rel="stylesheet" type="text/css" media="screen">
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js"></script>
        <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDMcldNQv43OCqtkWK1ruYgvrPWWhd0ASM",
            authDomain: "cse134b-hw4-41ab1.firebaseapp.com",
            databaseURL: "https://cse134b-hw4-41ab1.firebaseio.com",
            projectId: "cse134b-hw4-41ab1",
            storageBucket: "cse134b-hw4-41ab1.appspot.com",
            messagingSenderId: "1059552826976"
        };
        firebase.initializeApp(config);
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            firebase.database().ref("users/"+user.uid+"/method").once("value").then(function(snapshot){
                console.log(snapshot.val());
                placeDeliveryButton(snapshot.val());
                if(snapshot.val() === "rest"){
                    if(document.readyState === "complete"){
                        var submitButton = document.getElementById("addSubmit");
                        submitButton.onclick=function(){addNewIssueToRestDB(user.uid)};
                    }else{
                        window.addEventListener("load",function(){
                            var submitButton = document.getElementById("addSubmit");
                            submitButton.onclick=function(){addNewIssueToRestDB(user.uid)};
                        });
                    }
                }else{
                    if(document.readyState === "complete"){
                        var submitButton = document.getElementById("addSubmit");
                        submitButton.onclick=function(){addNewIssueToFirebase(user.uid)};
                    }else{
                        window.addEventListener("load",function(){
                            var submitButton = document.getElementById("addSubmit");
                            submitButton.onclick=function(){addNewIssueToFirebase(user.uid)};
                        });
                    }
                }
            });
          } else {
            window.location.replace("index.html");
          }
        });
        </script>
        <script src="scripts/add.js"></script>
    </head>
    <body>
        <button id="signOutButton" onclick="(function() {
            firebase.auth().signOut().then(function() {
                // Sign-out successful.
                }).catch(function(error) {
                console.log(error);
                console.log('Sign out error');
                });
        })()">Sign out</button>
        <h1>Add Issue</h1>
        <form id="mainform" action="issueslist.html" method=get>
            <label>
                Issue Title<br>
                <input id="addTitle" type="text" required>
            </label>
            <br>
            <br>
            <label>
                Issue Type<br>
                <select id="addType" required>
                    <optgroup label="Select an option">
                        <option>Visual</option>
                        <option>Functionality</option>
                        <option>Other</option>
                    </optgroup>
                </select>
            </label>
            <br>
            <br>
            <label>
                Issue Description:<br>
                <textarea id="addDescription" required></textarea>
            </label>
            <br>
            <input id="addSubmit" type="submit" value="Submit">
        </form>
        
        <p>OR</p>
        <form action="issueslist.html" method="GET">
            <button>Return to Issues List</button>
        </form>
    </body>
</html>